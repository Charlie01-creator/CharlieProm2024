
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Central College Mityana â€” Prom 2024 Photos</title>
  <meta name="description" content="Central College Mityana Prom 2024 â€” browse, download, and share watermarked photos" />
  <meta property="og:title" content="Central College Mityana â€” Prom 2024 Photos" />
  <meta property="og:description" content="Browse, download, and share watermarked photos" />
  <meta property="og:type" content="website" />
  <style>
    :root {
      --bg:#0b0d0f; --panel:#0f1316; --muted:#93a2ad; --text:#e8eef2; --accent:#6cd4ff; --accent-2:#a0ffcf;
      --card:#12181d; --ring:#20303b; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--accent)}
    header{position:sticky;top:0;z-index:40;background:rgba(11,13,15,.75);backdrop-filter:blur(8px);border-bottom:1px solid var(--ring)}
    .wrap{max-width:1100px;margin:0 auto;padding:14px 16px}
    .row{display:flex;align-items:center;gap:12px}
    .grow{flex:1}
    .brand{font-weight:800;letter-spacing:.2px}
    .badge{font-size:.72rem;padding:2px 8px;border:1px solid var(--ring);border-radius:999px;color:var(--muted)}
    .cta{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#041216;font-weight:700;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .ghost{background:transparent;border:1px solid var(--ring);color:var(--text);border-radius:10px;padding:9px 12px}
    main{padding:18px 0}

    /* Banner */
    .hero{background:radial-gradient(1200px 400px at 10% -10%,#164e63 0%,transparent 50%),radial-gradient(900px 300px at 100% 0%,#3730a3 0%,transparent 50%);border-bottom:1px solid var(--ring)}
    .hero .inner{padding:28px 16px 16px}
    .hero h1{margin:0 0 6px;font-size:clamp(20px,4vw,34px)}
    .hero p{margin:0;color:var(--muted)}

    /* Controls */
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin:14px 0}
    .chip{border:1px solid var(--ring);padding:6px 10px;border-radius:999px;color:var(--muted);cursor:pointer}
    .chip.active{border-color:var(--accent);color:var(--text)}

    /* Gallery grid â€” 2 / 3 / 4 columns */
    .grid{display:grid;gap:8px}
    @media (max-width: 640px){ .grid{grid-template-columns: repeat(2, 1fr);} }
    @media (min-width: 641px) and (max-width: 1024px){ .grid{grid-template-columns: repeat(3, 1fr);} }
    @media (min-width: 1025px){ .grid{grid-template-columns: repeat(4, 1fr);} }

    .card{position:relative;background:var(--card);border-radius:12px;overflow:hidden;border:1px solid var(--ring)}
    .card img{width:100%;height:100%;display:block;object-fit:cover;aspect-ratio:1/1}
    .card .shade{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.55),transparent 40%)}
    .card .btns{position:absolute;left:8px;bottom:8px;display:flex;gap:6px}
    .sm{font-size:.82rem;padding:6px 8px;border-radius:8px;border:1px solid var(--ring);background:rgba(15,19,22,.7);backdrop-filter:blur(6px);color:var(--text)}
    .sm[disabled]{opacity:.5;cursor:not-allowed}

    /* Lightbox */
    dialog{border:none;border-radius:14px;background:#0b0d0fbf;backdrop-filter:blur(10px);width:100%;max-width:min(96vw,1100px)}
    .lb{display:grid;grid-template-columns: 1fr;gap:8px;padding:0}
    .lb .media{background:#000;border-radius:12px;overflow:hidden;border:1px solid var(--ring)}
    .lb .media img{width:100%;display:block;max-height:70vh;object-fit:contain}
    .lb .tools{display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;align-items:center;background:var(--panel);padding:10px;border-radius:12px;border:1px solid var(--ring)}
    .muted{color:var(--muted)}

    /* Auth modal */
    .modal{border:1px solid var(--ring);padding:0}
    .panel{padding:16px;background:var(--panel);border-radius:12px}
    .input{width:100%;padding:10px 12px;border-radius:10px;background:#0d1216;border:1px solid var(--ring);color:var(--text)}
    .row-gap{display:grid;gap:10px}

    /* Footer */
    footer{border-top:1px solid var(--ring);color:var(--muted);padding:30px 16px;margin-top:24px}

    /* Misc */
    .hide{display:none}
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <div class="brand">Central College Mityana â€¢ Prom 2024 <span class="badge">Official Photos</span></div>
      <div class="grow"></div>
      <button id="signinBtn" class="ghost">Sign in</button>
      <button id="adminBtn" class="ghost">Admin</button>
    </div>
  </header>

  <section class="hero">
    <div class="wrap inner">
      <h1>Relive Prom 2024 ðŸŽ‰</h1>
      <p>Browse the gallery. Sign in to download or share watermarked photos.<br>
         Watermark: <strong>charlie02056@gmail.com / 0700955563</strong></p>
      <div class="controls">
        <button class="chip active" data-filter="all">All</button>
        <button class="chip" data-filter="pre">Preâ€‘Prom</button>
        <button class="chip" data-filter="night">Prom Night</button>
        <button class="chip" data-filter="after">After Party</button>
      </div>
    </div>
  </section>

  <main class="wrap">
    <div id="gallery" class="grid" aria-live="polite"></div>
  </main>

  <footer class="wrap">
    Prom 2024 â€¢ Central College Mityana â€¢ For issues: <a href="mailto:charlie02056@gmail.com">charlie02056@gmail.com</a> â€¢ <span>0700955563</span>
  </footer>

  <!-- Lightbox -->
  <dialog id="lightbox">
    <div class="lb wrap">
      <div class="media"><img id="lbImg" alt="Selected photo" /></div>
      <div class="tools">
        <div class="muted" id="lbMeta">Watermark applied on export</div>
        <div class="row" style="gap:8px">
          <button id="dlBtn" class="cta">Download (Watermarked)</button>
          <button id="shareBtn" class="ghost">Share</button>
          <button id="closeLb" class="ghost">Close</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Auth Modal -->
  <dialog id="auth" class="modal">
    <div class="panel wrap" style="max-width:420px">
      <h2 style="margin:0 0 8px">Sign in to Continue</h2>
      <p class="muted" style="margin:0 0 12px">Email + password only. (Demo: stored locally for now.)</p>
      <div class="row-gap">
        <input id="authEmail" class="input" type="email" placeholder="your@email.com" />
        <input id="authPass" class="input" type="password" placeholder="Password" />
        <div class="row" style="gap:8px">
          <button id="doSignin" class="cta">Sign in</button>
          <button id="doSignup" class="ghost">Create account</button>
          <button id="closeAuth" class="ghost">Close</button>
        </div>
        <div id="authMsg" class="muted"></div>
      </div>
    </div>
  </dialog>

  <!-- Admin Modal (clientâ€‘only uploader + compression) -->
  <dialog id="admin" class="modal">
    <div class="panel wrap" style="max-width:560px">
      <h2 style="margin:0 0 8px">Admin Upload</h2>
      <p class="muted" style="margin:0 0 12px">Bulk add images (compressed to WebP thumbnails). Localâ€‘only in this demo.</p>
      <div class="row-gap">
        <input id="adminPin" class="input" placeholder="Enter admin PIN (demo: 2024)" />
        <input id="filePick" class="input" type="file" accept="image/*" multiple />
        <progress id="prog" max="100" value="0" class="hide"></progress>
        <div class="row" style="gap:8px">
          <button id="ingest" class="cta">Add to Gallery</button>
          <button id="wipe" class="ghost">Clear Local Photos</button>
          <button id="closeAdmin" class="ghost">Close</button>
        </div>
        <div class="muted">Tip: We generate tiny thumbnails (â‰¤ 12 KB each) to keep total under 10 MB for 800+ items. Fullâ€‘size is created only during export.</div>
      </div>
    </div>
  </dialog>

  <script>
  // =========================
  // Auth (clientâ€‘only demo)
  // =========================
  const auth = {
    get user(){ try{return JSON.parse(localStorage.getItem('ccm_user')||'null')}catch{return null} },
    save(u){ localStorage.setItem('ccm_user', JSON.stringify(u)); },
    clear(){ localStorage.removeItem('ccm_user'); }
  };
  const authDlg = document.getElementById('auth');
  document.getElementById('signinBtn').onclick = () => authDlg.showModal();
  document.getElementById('closeAuth').onclick = () => authDlg.close();
  document.getElementById('doSignup').onclick = () => {
    const email = document.getElementById('authEmail').value.trim();
    const pass = document.getElementById('authPass').value.trim();
    if(!email||!pass) return msg('Enter email and password');
    auth.save({email});
    msg('Account created. You are signed in.');
    setTimeout(()=>authDlg.close(),600);
  };
  document.getElementById('doSignin').onclick = () => {
    const email = document.getElementById('authEmail').value.trim();
    const pass = document.getElementById('authPass').value.trim();
    if(!email||!pass) return msg('Enter email and password');
    auth.save({email});
    msg('Signed in successfully.');
    setTimeout(()=>authDlg.close(),600);
  };
  function msg(t){ document.getElementById('authMsg').textContent = t; }

  function requireAuth(){
    if(!auth.user){ authDlg.showModal(); return false; }
    return true;
  }

  // =========================
  // Ultraâ€‘light placeholder thumbnail (SVG) â€” ~300 bytes
  // =========================
  const tinyThumb = `data:image/svg+xml;base64,${btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='400' height='400'>\n  <defs>\n    <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>\n      <stop offset='0%' stop-color='#1f2937'/>\n      <stop offset='100%' stop-color='#0f172a'/>\n    </linearGradient>\n  </defs>\n  <rect width='100%' height='100%' fill='url(#g)'/>\n  <text x='50%' y='55%' text-anchor='middle' font-family='Inter,Arial' font-size='28' fill='rgba(255,255,255,0.85)'>PROM 2024</text>\n</svg>`)}`;

  // Seed 800+ items with categories. Real images can be uploaded via Admin.
  const SEED_COUNT = 810; // â‰¥800
  const CATS = ['pre','night','after'];
  let items = Array.from({length: SEED_COUNT}, (_,i)=>({
    id: i+1,
    cat: CATS[i % CATS.length],
    thumb: tinyThumb,    // ultra small â€“ keeps initial load tiny
    full: tinyThumb      // replaced by real photo during admin upload or backend
  }));

  // Persist local admin uploads across reloads
  const stored = localStorage.getItem('ccm_photos');
  if(stored){
    try { const extra = JSON.parse(stored); if(Array.isArray(extra) && extra.length){
      // Place uploaded items first
      items = extra.concat(items.slice(0, Math.max(0, SEED_COUNT - extra.length)));
    }} catch{}
  }

  // =========================
  // Render gallery with lazy loading
  // =========================
  const gal = document.getElementById('gallery');
  function render(list){
    gal.innerHTML = '';
    const frag = document.createDocumentFragment();
    list.forEach(obj=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.cat = obj.cat;
      const img = document.createElement('img');
      img.loading = 'lazy';
      img.decoding = 'async';
      img.src = obj.thumb; // tiny preview
      img.alt = `Prom 2024 photo #${obj.id}`;
      img.addEventListener('click',()=>openLightbox(obj));
      const shade = document.createElement('div'); shade.className='shade';
      const btns = document.createElement('div'); btns.className='btns';
      const v = document.createElement('button'); v.className='sm'; v.textContent='Open';
      v.onclick = ()=>openLightbox(obj);
      btns.appendChild(v);
      card.append(img, shade, btns);
      frag.appendChild(card);
    });
    gal.appendChild(frag);
  }
  render(items);

  // Filtering
  document.querySelectorAll('.chip').forEach(c=>{
    c.addEventListener('click',()=>{
      document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      c.classList.add('active');
      const f = c.dataset.filter;
      const list = (f==='all') ? items : items.filter(x=>x.cat===f);
      render(list);
    });
  });

  // =========================
  // Lightbox + watermark export
  // =========================
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lbImg');
  let current = null;

  function openLightbox(obj){
    current = obj;
    lbImg.src = obj.full || obj.thumb;
    lb.showModal();
  }
  document.getElementById('closeLb').onclick = ()=>lb.close();

  async function drawWatermark(src){
    const img = await loadImage(src);
    const maxSide = 1600; // reasonable export size
    const scale = Math.min(maxSide / img.width, maxSide / img.height, 1);
    const w = Math.round(img.width * scale); const h = Math.round(img.height * scale);
    const c = document.createElement('canvas'); c.width = w; c.height = h;
    const ctx = c.getContext('2d');
    ctx.drawImage(img, 0, 0, w, h);

    // watermark text
    const wmText = 'Central College Mityana â€” Prom 2024  |  charlie02056@gmail.com / 0700955563';
    ctx.globalAlpha = 0.55;
    ctx.fillStyle = '#000';
    ctx.fillRect(0, h - 56, w, 56);
    ctx.globalAlpha = 0.8;
    ctx.font = '16px Inter, Arial';
    ctx.fillStyle = '#fff';
    ctx.textBaseline = 'middle';
    ctx.fillText(wmText, 12, h - 28);

    // optional diagonal repeats for extra protection
    ctx.globalAlpha = 0.13;
    ctx.translate(w/2, h/2); ctx.rotate(-Math.PI/6); ctx.translate(-w/2, -h/2);
    ctx.font = '28px Inter, Arial';
    for(let y=-200; y<h+200; y+=180){
      for(let x=-200; x<w+200; x+=420){
        ctx.fillText('CCM PROM 2024', x, y);
      }
    }

    return c;
  }

  function loadImage(src){
    return new Promise((res,rej)=>{ const i=new Image(); i.crossOrigin='anonymous'; i.onload=()=>res(i); i.onerror=rej; i.src=src; });
  }

  async function ensureAuthThen(fn){
    if(!requireAuth()) return;
    try{ await fn(); }catch(e){ alert('Error: '+e.message); }
  }

  document.getElementById('dlBtn').onclick = ()=>ensureAuthThen(async ()=>{
    const can = await drawWatermark(current.full || current.thumb);
    const a = document.createElement('a');
    a.download = `ccm-prom-2024-${current.id}.webp`;
    a.href = can.toDataURL('image/webp', 0.92);
    a.click();
  });

  document.getElementById('shareBtn').onclick = ()=>ensureAuthThen(async ()=>{
    const can = await drawWatermark(current.full || current.thumb);
    const blob = await new Promise(r=>can.toBlob(r, 'image/webp', 0.92));
    if(navigator.canShare && navigator.canShare({ files: [new File([blob], 'photo.webp', {type:'image/webp'})] })){
      await navigator.share({
        title: 'CCM Prom 2024',
        text: 'Central College Mityana â€” Prom 2024 (watermarked)',
        files: [new File([blob], `ccm-prom-2024-${current.id}.webp`, {type:'image/webp'})]
      });
    } else {
      // Fallback: open in new tab
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
      setTimeout(()=>URL.revokeObjectURL(url), 5000);
    }
  });

  // =========================
  // Admin (clientâ€‘only demo): compress to tiny thumbnails, store in localStorage
  // =========================
  const adminDlg = document.getElementById('admin');
  document.getElementById('adminBtn').onclick = ()=>adminDlg.showModal();
  document.getElementById('closeAdmin').onclick = ()=>adminDlg.close();

  document.getElementById('ingest').onclick = async ()=>{
    const pin = (document.getElementById('adminPin').value||'').trim();
    if(pin !== '2024'){ return alert('Wrong PIN'); }
    const files = Array.from(document.getElementById('filePick').files||[]);
    if(!files.length) return alert('Pick some images');
    const prog = document.getElementById('prog'); prog.classList.remove('hide');

    const added = [];
    let k=0;
    for(const f of files){
      const img = await fileToImage(f);
      const thumbUrl = await toThumb(img, 420); // small grid thumb
      const fullUrl = await toFull(img, 1600); // full shown in lightbox (export still re-draws)
      added.push({id: Date.now()+Math.random(), cat: CATS[k++%CATS.length], thumb: thumbUrl, full: fullUrl});
      prog.value = Math.round((added.length/files.length)*100);
    }

    // Keep local storage small: store only compressed data URLs
    const prev = JSON.parse(localStorage.getItem('ccm_photos')||'[]');
    const merged = added.concat(prev).slice(0, 1200); // cap
    localStorage.setItem('ccm_photos', JSON.stringify(merged));

    // Prepend to items and re-render
    items = merged.concat(items).slice(0, Math.max(SEED_COUNT, merged.length));
    render(items);
    alert('Uploaded! (Local only)');
    prog.classList.add('hide'); prog.value=0;
  };

  document.getElementById('wipe').onclick = ()=>{
    if(confirm('Clear locally stored photos?')){
      localStorage.removeItem('ccm_photos');
      location.reload();
    }
  };

  function fileToImage(file){
    return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>{ const i=new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=r.result; }; r.onerror=rej; r.readAsDataURL(file); });
  }
  function toThumb(img, max){ return scaleTo(img, max, 'image/webp', 0.6); } // ~â‰¤12KB typical
  function toFull(img, max){ return scaleTo(img, max, 'image/webp', 0.85); }
  function scaleTo(img, max, type, q){
    const s = Math.min(max/img.width, max/img.height, 1);
    const w = Math.round(img.width*s), h=Math.round(img.height*s);
    const c=document.createElement('canvas'); c.width=w; c.height=h; const ctx=c.getContext('2d');
    ctx.drawImage(img,0,0,w,h);
    return c.toDataURL(type, q);
  }

  // =========================
  // Nonâ€‘functional protections
  // =========================
  // Disable rightâ€‘click on gallery images
  document.addEventListener('contextmenu', (e)=>{
    if(e.target.closest('.card, .lb')) e.preventDefault();
  });

  </script>
</body>
</html>
