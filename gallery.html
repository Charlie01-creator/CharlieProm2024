<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Central College Mityana — Gallery</title>
  <style>
    :root {
      --brand: #e91e63;
      --brand2: #ff4081;
      --light-gray: #f5f5f5;
      --medium-gray: #e0e0e0;
      --dark-gray: #9e9e9e;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #fff;
    }

    /* Header Styles */
    header {
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .nav {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-weight: 800;
      color: var(--brand);
      text-decoration: none;
      font-size: 1.2rem;
    }

    .links {
      display: flex;
      align-items: center;
      gap: 22px;
    }

    .links a {
      padding: 10px 6px;
      font-weight: 500;
      color: #333;
      position: relative;
      text-decoration: none;
    }

    .links a.active::after,
    .links a:hover::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 4px;
      height: 2px;
      width: 100%;
      background: linear-gradient(90deg, var(--brand), var(--brand2));
      border-radius: 2px;
    }

    .cta-sign {
      margin-left: 6px;
      border: 0;
      padding: 10px 16px;
      border-radius: 999px;
      cursor: pointer;
      background: linear-gradient(45deg, var(--brand), var(--brand2));
      color: #fff;
      font-weight: 700;
      box-shadow: 0 6px 14px rgba(233,30,99,.2);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .cta-sign:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(233,30,99,.3);
    }

    /* Mobile Navigation */
    .burger {
      display: none;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
      background: none;
      border: none;
      padding: 5px;
    }

    .burger span {
      width: 26px;
      height: 3px;
      background: #333;
      border-radius: 3px;
      transition: .25s;
    }

    .drawer {
      display: none;
      position: fixed;
      inset: 0 0 0 auto;
      width: min(78vw, 320px);
      height: 100vh;
      background: #fff;
      padding: 90px 24px 24px;
      box-shadow: -12px 0 30px rgba(0,0,0,.12);
      z-index: 1001;
    }

    .drawer a {
      display: block;
      padding: 14px 0;
      border-bottom: 1px solid #eee;
      color: #333;
      text-decoration: none;
    }

    .scrim {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      z-index: 1000;
    }

    .noscr {
      overflow: hidden;
    }

    @media (max-width: 900px) {
      .links {
        display: none;
      }
      
      .burger {
        display: flex;
      }
    }

    /* Gallery Styles */
    .gallery-controls {
      max-width: 1200px;
      margin: 30px auto 20px;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .gallery-controls h1 {
      color: var(--brand);
      font-size: 2rem;
    }

    .search-box {
      padding: 10px 16px;
      border: 1px solid #ddd;
      border-radius: 24px;
      width: 250px;
      font-size: 14px;
    }

    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      max-width: 1200px;
      margin: 0 auto 40px;
      padding: 0 20px;
    }

    .gallery-column {
      flex: 1;
      min-width: calc(33.33% - 7px);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .gallery-item {
      width: 100%;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,.1);
      cursor: pointer;
      position: relative;
    }

    .gallery-item img {
      width: 100%;
      height: auto;
      display: block;
      transition: transform 0.3s;
    }

    .gallery-item img:hover {
      transform: scale(1.02);
    }

    .gallery-item .image-number {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    /* Image Loading States */
    .image-placeholder {
      width: 100%;
      padding-bottom: 75%; /* 4:3 aspect ratio */
      background: var(--light-gray);
      position: relative;
    }

    .image-placeholder::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      border: 3px solid var(--medium-gray);
      border-top: 3px solid var(--brand);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .loading {
      text-align: center;
      padding: 30px;
      color: #666;
    }

    /* Lightbox Styles */
    #lightbox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      justify-content: center;
      align-items: center;
      z-index: 1002;
    }

    #lightbox.active {
      display: flex;
    }

    #lightbox img {
      max-width: 90%;
      max-height: 80%;
      border-radius: 12px;
    }

    #lightbox-caption {
      margin-top: 12px;
      color: #fff;
      font-size: 1rem;
      text-align: center;
    }

    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lightbox-prev {
      left: 20px;
    }

    .lightbox-next {
      right: 20px;
    }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
    }

    /* Footer Styles */
    footer {
      padding: 28px 20px;
      text-align: center;
      color: #888;
      background: #fff;
      border-top: 1px solid #eee;
    }

    footer a {
      color: #888;
      text-decoration: none;
      margin: 0 4px;
    }

    footer a:hover {
      color: var(--brand);
    }

    /* Scroll to Top Button */
    #scrollTop {
      position: fixed;
      bottom: 24px;
      right: 24px;
      display: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: var(--brand);
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,.2);
      z-index: 999;
      transition: opacity 0.3s, transform 0.3s;
    }

    #scrollTop:hover {
      transform: translateY(-3px);
      background: var(--brand2);
    }

    /* Responsive Adjustments */
    @media (max-width: 900px) {
      .gallery-column {
        min-width: calc(50% - 5px);
      }
    }

    @media (max-width: 600px) {
      .gallery-column {
        min-width: 100%;
      }
      
      .gallery-controls {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
      
      .search-box {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <a class="logo" href="#home" aria-label="Home">
        Central College Mityana • Prom 2024
      </a>
      <nav class="links">
        <a href="index.html">Home</a>
        <a href="#about">About</a>
        <a href="#highlights">Highlights</a>
        <a href="gallery.html" class="active">Gallery</a>
        <a href="#share">Share</a>
        <a href="support.html">Support</a>
        <a href="contact.html">Contact</a>
        <button class="cta-sign" onclick="openSign()">Sign In</button>
      </nav>
      <button class="burger" id="burger" aria-label="Open menu" onclick="toggleDrawer()">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- Mobile drawer -->
  <aside class="drawer" id="drawer" role="dialog" aria-modal="true">
    <a href="index.html" onclick="closeDrawer()">Home</a>
    <a href="#about" onclick="closeDrawer()">About</a>
    <a href="#highlights" onclick="closeDrawer()">Highlights</a>
    <a href="gallery.html" onclick="closeDrawer()">Gallery</a>
    <a href="#share" onclick="closeDrawer()">Share</a>
    <a href="support.html" onclick="closeDrawer()">Support</a>
    <a href="contact.html" onclick="closeDrawer()">Contact</a>
    <button class="cta-sign" style="margin-top:16px" onclick="closeDrawer(); openSign()">Sign In</button>
  </aside>
  <div class="scrim" id="scrim" onclick="closeDrawer()"></div>

  <!-- Gallery Controls -->
  <div class="gallery-controls">
    <h1>Prom Gallery</h1>
    <input type="text" class="search-box" id="searchBox" placeholder="Search images..." oninput="filterImages()">
  </div>

  <!-- Gallery -->
  <div class="gallery" id="gallery-container"></div>
  <div id="loading" class="loading">Loading images...</div>

  <!-- Lightbox -->
  <div id="lightbox" onclick="closeLightbox(event)">
    <button class="lightbox-close" onclick="closeLightbox()">×</button>
    <button class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">❮</button>
    <div>
      <img src="" alt="Lightbox Image">
      <div id="lightbox-caption"></div>
    </div>
    <button class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">❯</button>
  </div>

  <!-- Scroll to top -->
  <button id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</button>

  <!-- Footer -->
  <footer>
    <div style="font-weight:700; color:#e91e63">Central College Mityana Prom Memories</div>
    <div style="margin-top:10px;">
      <a href="index.html">Home</a>•
      <a href="gallery.html">Gallery</a>•
      <a href="about.html">About</a>•
      <a href="#">Terms</a>•
      <a href="#">Privacy</a>
    </div>
    <div style="margin-top:8px">© 2024 Central College Mityana Prom. All rights reserved.</div>
  </footer>

  <!-- Sign-in Modal -->
  <dialog id="signinModal" style="border:none; border-radius:16px; padding:0; max-width:420px; width:92vw;">
    <div style="padding:22px 22px 18px">
      <h3 style="margin:0 0 8px">Sign in to Share Images</h3>
      <p style="margin:0 0 12px">Enter your email to continue.</p>
      <input type="email" id="emailModal" placeholder="you@example.com" style="width:100%; padding:8px; margin-bottom:12px;">
      <div style="display:flex; gap:8px;">
        <button class="cta-sign" onclick="applyModalSign()">Continue</button>
        <button class="cta-sign" style="background:#aaa;" onclick="closeSign()">Cancel</button>
      </div>
    </div>
  </dialog>

  <script>
    // Header drawer
    const drawer = document.getElementById('drawer');
    const scrim = document.getElementById('scrim');
    function toggleDrawer() {
      drawer.style.display = 'block';
      scrim.style.display = 'block';
      document.body.classList.add('noscr');
    }
    function closeDrawer() {
      drawer.style.display = 'none';
      scrim.style.display = 'none';
      document.body.classList.remove('noscr');
    }

    // Sign modal
    const modal = document.getElementById('signinModal');
    function openSign() { modal.showModal(); }
    function closeSign() { modal.close(); }
    function applyModalSign() { 
      const email = document.getElementById('emailModal').value;
      if (email) {
        alert('Email submitted: ' + email); 
        closeSign(); 
      } else {
        alert('Please enter your email address');
      }
    }

    // Scroll to top button
    window.addEventListener('scroll', () => {
      const scrollBtn = document.getElementById('scrollTop');
      scrollBtn.style.display = window.scrollY > 300 ? 'block' : 'none';
    });

    // Gallery
    const TOTAL_IMAGES = 18;
    const IMAGES_PER_LOAD = 9;
    const COLUMN_COUNT = 3;
    const gallery = document.getElementById('gallery-container');
    const loadingElement = document.getElementById('loading');
    let loadedCount = 0;
    const columns = [];
    let allImageElements = [];
    let currentLightboxIndex = 0;
    const EXCLUDED_IMAGES = [12, 17, 18]; // Images to exclude

    function createGalleryColumns() {
      for (let i = 0; i < COLUMN_COUNT; i++) {
        const column = document.createElement('div');
        column.className = 'gallery-column';
        gallery.appendChild(column);
        columns.push(column);
      }
    }

    function createImageElement(imageNumber) {
      // Skip excluded images
      if (EXCLUDED_IMAGES.includes(imageNumber)) {
        return;
      }

      const item = document.createElement('div');
      item.className = 'gallery-item';
      item.dataset.number = imageNumber;

      // Create placeholder
      const placeholder = document.createElement('div');
      placeholder.className = 'image-placeholder';
      item.appendChild(placeholder);

      const numberBadge = document.createElement('div');
      numberBadge.className = 'image-number';
      numberBadge.textContent = '#' + imageNumber;
      item.appendChild(numberBadge);

      // Create image (will load later)
      const img = document.createElement('img');
      img.src = ''; // Start with empty src
      img.alt = 'Prom Image ' + imageNumber;
      img.dataset.src = imageNumber + '.jpg'; // Store real source in data attribute
      img.dataset.number = imageNumber;
      img.style.display = 'none'; // Hide initially

      // Add error handling for missing images
      img.onerror = function() {
        this.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200" viewBox="0 0 300 200"><rect width="100%" height="100%" fill="%23f5f5f5"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" fill="%23ccc">Image ' + imageNumber + ' not found</text></svg>';
        this.style.border = '1px solid #eee';
        placeholder.style.display = 'none';
        this.style.display = 'block';
      };

      img.onload = function() {
        placeholder.style.display = 'none';
        this.style.display = 'block';
      };

      item.appendChild(img);
      item.addEventListener('click', () => openLightbox(img));

      // Store reference to all image elements
      allImageElements.push({
        element: item,
        number: imageNumber,
        imgElement: img
      });

      // Distribute images evenly across columns
      columns[(imageNumber - 1) % COLUMN_COUNT].appendChild(item);
      
      return item;
    }

    function loadImages(count) {
      const endIndex = Math.min(loadedCount + count, TOTAL_IMAGES);
      for (let i = loadedCount + 1; i <= endIndex; i++) {
        createImageElement(i);
      }
      loadedCount = endIndex;
      
      // Load images that are in viewport
      lazyLoadImages();
      
      if (loadedCount >= TOTAL_IMAGES) loadingElement.style.display = 'none';
    }

    function lazyLoadImages() {
      allImageElements.forEach(item => {
        const img = item.imgElement;
        // If image hasn't been loaded yet and is in viewport
        if (img.src === '' && isInViewport(img.parentElement)) {
          img.src = img.dataset.src;
        }
      });
    }

    function isInViewport(element) {
      const rect = element.getBoundingClientRect();
      return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) * 1.5 &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
      );
    }

    function setupScrollListener() {
      let ticking = false;
      
      window.addEventListener('scroll', function() {
        if (!ticking) {
          window.requestAnimationFrame(function() {
            lazyLoadImages();
            ticking = false;
            
            // Load more images if needed
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
              if (loadedCount < TOTAL_IMAGES) loadImages(IMAGES_PER_LOAD);
            }
          });
          ticking = true;
        }
      });
    }

    // Lightbox
    const lb = document.getElementById('lightbox');
    const lbImg = lb.querySelector('img');
    const lbCaption = document.getElementById('lightbox-caption');
    
    function openLightbox(img) {
      const imageNumber = parseInt(img.dataset.number);
      currentLightboxIndex = allImageElements.findIndex(item => item.number === imageNumber);
      
      // Make sure we have the full resolution image for lightbox
      lbImg.src = img.dataset.src;
      lbCaption.textContent = img.alt;
      lb.classList.add('active');
      document.body.classList.add('noscr');
    }
    
    function closeLightbox(event) {
      // Only close if clicking on background, not on image or buttons
      if (event && event.target === lb) {
        lb.classList.remove('active');
        document.body.classList.remove('noscr');
      } else if (!event) {
        lb.classList.remove('active');
        document.body.classList.remove('noscr');
      }
    }
    
    function navigateLightbox(direction) {
      currentLightboxIndex += direction;
      
      // Wrap around if at beginning or end
      if (currentLightboxIndex < 0) currentLightboxIndex = allImageElements.length - 1;
      if (currentLightboxIndex >= allImageElements.length) currentLightboxIndex = 0;
      
      const nextImage = allImageElements[currentLightboxIndex].imgElement;
      lbImg.src = nextImage.dataset.src;
      lbCaption.textContent = nextImage.alt;
    }

    // Filter images based on search input
    function filterImages() {
      const searchText = document.getElementById('searchBox').value.toLowerCase();
      
      allImageElements.forEach(item => {
        const shouldShow = searchText === '' || 
                          item.number.toString().includes(searchText) || 
                          item.imgElement.alt.toLowerCase().includes(searchText);
        
        item.element.style.display = shouldShow ? 'block' : 'none';
      });
    }

    // Initialize gallery
    document.addEventListener('DOMContentLoaded', function() {
      createGalleryColumns();
      loadImages(IMAGES_PER_LOAD);
      setupScrollListener();
    });
  </script>
</body>
</html>
