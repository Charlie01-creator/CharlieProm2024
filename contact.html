<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lightweight image gallery">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{background:#f5f5f5;padding:5px;user-select:none}.gallery{display:flex;gap:5px}.gallery-column{flex:1;display:flex;flex-direction:column;gap:5px}.gallery-item{width:100%;background:#fff;border-radius:4px;overflow:hidden;box-shadow:0 1px 2px rgba(0,0,0,0.05);position:relative;aspect-ratio:3/4}.gallery-item img{width:100%;height:100%;display:block;object-fit:cover;background:#e0e0e0}.watermark{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:2;opacity:0.1;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Ctext x='50%25' y='50%25' fill='black' font-size='10' text-anchor='middle' dominant-baseline='middle' transform='rotate(-30 50 50)'%3EAG%3C/text%3E%3C/svg%3E")}.img-placeholder{width:100%;height:100%;background:#e0e0e0}
    </style>
</head>
<body>
    <div class="gallery">
        <div class="gallery-column" id="col1"></div>
        <div class="gallery-column" id="col2"></div>
        <div class="gallery-column" id="col3"></div>
    </div>

    <script>
        (function() {
            // Configuration
            const config = {
                imageQuality: navigator.connection?.effectiveType.includes('2g') ? 'low-' : '',
                loadThreshold: 300,
                maxColumns: window.innerWidth < 600 ? 2 : 3
            };
            
            // Image data: [filename, width, height, placeholder color]
            const images = [
                ['1.jpg', 800, 600, 'e0d0c0'], ['2.jpg', 800, 600, 'd0e0c0'],
                ['3.jpg', 800, 600, 'c0d0e0'], ['4.jpg', 800, 600, 'e0c0d0'],
                ['5.jpg', 800, 600, 'd0e0d0'], ['6.jpg', 800, 600, 'c0e0e0'],
                ['7.jpg', 800, 600, 'e0e0c0'], ['8.jpg', 800, 600, 'd0d0e0'],
                ['9.jpg', 800, 600, 'e0d0d0'], ['10.jpg', 800, 600, 'c0c0e0'],
                ['11.jpg', 800, 600, 'e0c0c0'], ['12.jpg', 800, 600, 'd0c0e0'],
                ['13.jpg', 800, 600, 'e0d0e0'], ['14.jpg', 800, 600, 'c0e0d0'],
                ['15.jpg', 800, 600, 'd0d0c0'], ['16.jpg', 800, 600, 'e0c0e0'],
                ['17.jpg', 800, 600, 'c0d0d0'], ['18.jpg', 800, 600, 'd0e0e0'],
                ['19.jpg', 800, 600, 'e0e0d0'], ['20.jpg', 800, 600, 'c0c0d0']
            ];
            
            // DOM elements
            const columns = [
                document.getElementById('col1'),
                document.getElementById('col2'),
                document.getElementById('col3')
            ].slice(0, config.maxColumns);
            
            // Create gallery items
            function createGalleryItem(imgData, index) {
                const [filename, width, height, color] = imgData;
                const col = index % columns.length;
                
                const item = document.createElement('div');
                item.className = 'gallery-item';
                item.innerHTML = `
                    <div class="watermark"></div>
                    <div class="img-placeholder" style="background:#${color}"></div>
                    <img 
                        data-src="${config.imageQuality}${filename}" 
                        alt="Image ${index+1}"
                        loading="lazy"
                        decoding="async"
                        width="${width}"
                        height="${height}"
                    >
                `;
                columns[col].appendChild(item);
                return item.querySelector('img');
            }
            
            // Lazy loading
            function initLazyLoad() {
                const io = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.onload = () => {
                                img.previousElementSibling.style.display = 'none';
                                img.removeAttribute('data-src');
                            };
                            img.onerror = () => {
                                img.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Crect fill="%23ddd" width="100" height="100"/%3E%3Ctext fill="%23666" font-size="10" dy=".35em" text-anchor="middle" x="50" y="50"%3EImage missing%3C/text%3E%3C/svg%3E';
                            };
                            io.unobserve(img);
                        }
                    });
                }, { threshold: 0.01, rootMargin: `${config.loadThreshold}px` });
                
                document.querySelectorAll('img[data-src]').forEach(img => io.observe(img));
            }
            
            // Initialize
            images.forEach((img, i) => createGalleryItem(img, i));
            initLazyLoad();
            
            // Basic protection
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.addEventListener('dragstart', e => e.target.tagName === 'IMG' && e.preventDefault());
        })();
    </script>
</body>
</html>
